#include "xparameters.h"
#include "xil_types.h"
#include "xil_printf.h"
#include "xil_io.h"

#include "calc.h"

// Get device IDs from xparameters.h
#define MIDI_OUT	XPAR_MIDI_FIFO_WRITER_BASEADDR

int main() {
	xil_printf("Hello, world!\r\n");

	int note, bend;
	pulse2midi(254, note, bend);
	xil_printf("%d %d\r\n", note, bend);
	// Xil_Out32(MIDI_OUT, 0b11'10110000'01111000'00000000); // Reset Notes (Hard) - Controller 120
	// Xil_Out32(MIDI_OUT, 0b11'10110000'01111001'00000000); // Reset Controllers - Controller 121
	// Xil_Out32(MIDI_OUT, 0b11'10110000'01111100'00000000); // Omni Off - Controller 124
	// Xil_Out32(MIDI_OUT, 0b11'10110000'01111110'00000101); // Mono On (5 channels) - Controller 126
	// for (int i = 0; i < 10000; i++) {Xil_Out32(MIDI_OUT, 0);}
	Xil_Out32(MIDI_OUT, 0b11'10010000'01000101'01111111); // Note On (A4 - 69)
	Xil_Out32(MIDI_OUT, 0b11'10000000'01000101'00000000); // Note Off (A4 - 69)
	Xil_Out32(MIDI_OUT, 0b11'10010000'00111100'01111111); // Note On (C4 - 60)
	// Xil_Out32(MIDI_OUT, 0b11'10110000'01111011'00000000); // Reset Notes (Soft) - Controller 123
	// Xil_Out32(MIDI_OUT, 0b11'10000000'01000101'00000000); // Note Off (A4 - 69)

	while (true) {}
}
