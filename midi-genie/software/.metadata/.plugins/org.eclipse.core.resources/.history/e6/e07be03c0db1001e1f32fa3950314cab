#include "apu.h"

int setup_apu_interrupts(XIntc* InterruptController)
{
    int Status;

    Status = XIntc_Connect(InterruptController, APU_MSG_INT_ID, (XInterruptHandler)apu_message_handler, (void*)0);
    if (Status != XST_SUCCESS) {
		return XST_FAILURE;
	}

    Status = XIntc_Start(InterruptController, XIN_REAL_MODE);
	if (Status != XST_SUCCESS) {
		return XST_FAILURE;
	}

    XIntc_Enable(InterruptController, APU_MSG_INT_ID);

    return XST_SUCCESS;
}

void apu_message_handler(void* CallbackRef)
{
    APUBitField apuMessage;
    read_apu_message(apuMessage);
    print_note_message(apuMessage);
}
